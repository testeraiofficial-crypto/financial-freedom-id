// ================================
// KONFIGURASI TETAP (FIXED RULES)
// ================================
const HUTANG_AWAL = 500000;
const ANGSURAN_HARIAN = 25000;
const TANGGAL_MULAI = new Date('2026-02-01');

// ================================
// STATE & STORAGE KEY
// ================================
const STORAGE_KEY = 'dataAngsuranHutang';

let state = {
  sisaHutang: HUTANG_AWAL,
  riwayat: [] // { tanggal, nominal, sisa }
};

// ================================
// LOAD DATA DARI LOCALSTORAGE
// ================================
function loadData() {
  const saved = localStorage.getItem(STORAGE_KEY);
  if (saved) {
    state = JSON.parse(saved);
  }
}

// ================================
// SAVE DATA KE LOCALSTORAGE
// ================================
function saveData() {
  localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
}

// ================================
// FORMAT RUPIAH
// ================================
function formatRupiah(angka) {
  return 'Rp ' + angka.toLocaleString('id-ID');
}

// ================================
// HITUNG ESTIMASI
// ================================
function hitungEstimasi() {
  const sisaHari = Math.ceil(state.sisaHutang / ANGSURAN_HARIAN);
  const tanggalLunas = new Date();
  tanggalLunas.setDate(tanggalLunas.getDate() + sisaHari);

  document.getElementById('sisaHari').textContent = sisaHari;
  document.getElementById('tanggalLunas').textContent = tanggalLunas.toLocaleDateString('id-ID', {
    day: '2-digit',
    month: 'short',
    year: 'numeric'
  });
}

// ================================
// RENDER INFO SALDO
// ================================
function renderSaldo() {
  document.getElementById('sisaHutang').textContent = formatRupiah(state.sisaHutang);
  hitungEstimasi();
}

// ================================
// PROSES ANGSURAN
// ================================
function bayarAngsuran() {
  if (state.sisaHutang <= 0) {
    alert('ðŸŽ‰ Hutang sudah lunas!');
    return;
  }

  state.sisaHutang -= ANGSURAN_HARIAN;
  if (state.sisaHutang < 0) state.sisaHutang = 0;

  const today = new Date().toLocaleDateString('id-ID');

  state.riwayat.unshift({
    tanggal: today,
    nominal: ANGSURAN_HARIAN,
    sisa: state.sisaHutang
  });

  saveData();
  renderSaldo();
  renderRiwayat();
}

// ================================
// RENDER RIWAYAT (SIMPLE)
// ================================
function renderRiwayat() {
  const list = document.getElementById('riwayatList');
  list.innerHTML = '';

  state.riwayat.forEach(item => {
    const li = document.createElement('li');
    li.innerHTML = `
      <strong>${item.tanggal}</strong><br>
      Angsuran: ${formatRupiah(item.nominal)}<br>
      Sisa: ${formatRupiah(item.sisa)}
    `;
    list.appendChild(li);
  });
}

// ================================
// INIT APP
// ================================
function init() {
  loadData();
  renderSaldo();
  renderRiwayat();

  document.getElementById('btnAngsur').addEventListener('click', bayarAngsuran);
}

init();
