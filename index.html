<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Pencatat Angsuran Hutang</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    :root {
      --bg: #f4f4f4;
      --text: #222;
      --card: #fff;
    }
    body.dark {
      --bg: #121212;
      --text: #eee;
      --card: #1e1e1e;
    }
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: var(--bg);
      color: var(--text);
      padding: 20px;
      transition: background 0.3s, color 0.3s;
    }
    .card {
      background: var(--card);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    }
    button {
      padding: 10px 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 16px;
    }
    .btn-primary { background: #4caf50; color: #fff; }
    .btn-secondary { background: #2196f3; color: #fff; }
    .btn-dark { background: #555; color: #fff; }

    /* Gemerlap animation */
    .sparkle {
      position: fixed;
      width: 8px;
      height: 8px;
      background: gold;
      border-radius: 50%;
      animation: sparkle 1s ease-out forwards;
      pointer-events: none;
    }
    @keyframes sparkle {
      from { transform: scale(1); opacity: 1; }
      to { transform: scale(3) translateY(-80px); opacity: 0; }
    }
  </style>
</head>
<body>
  <h1>ðŸ“’ Pencatat Angsuran Hutang</h1>

  <div class="card">
    <p><strong>Nilai Hutang Awal:</strong> Rp500.000</p>
    <p><strong>Angsuran Harian:</strong> Rp25.000</p>
    <p id="saldo"></p>
    <p id="estimasi"></p>
    <button class="btn-primary" onclick="angsuran()">Bayar Angsuran</button>
    <button class="btn-dark" onclick="toggleDark()">Dark Mode</button>
  </div>

  <div class="card">
    <h3>ðŸ“œ Riwayat Angsuran</h3>
    <ul id="riwayat"></ul>
  </div>

  <div class="card">
    <h3>ðŸ“Š Grafik Angsuran</h3>
    <canvas id="chart"></canvas>
  </div>

  <script>
    const hutangAwal = 500000;
    const angsuranHarian = 25000;
    const mulai = new Date('2026-02-01');

    let data = JSON.parse(localStorage.getItem('angsuran')) || [];

    function saldoSisa() {
      return hutangAwal - data.length * angsuranHarian;
    }

    function estimasiLunas() {
      const sisaHari = Math.ceil(saldoSisa() / angsuranHarian);
      const tgl = new Date();
      tgl.setDate(tgl.getDate() + sisaHari);
      return tgl.toLocaleDateString('id-ID');
    }

    function updateInfo() {
      document.getElementById('saldo').innerText = 'Sisa Hutang: Rp' + saldoSisa().toLocaleString('id-ID');
      document.getElementById('estimasi').innerText = 'Estimasi Lunas: ' + estimasiLunas();
    }

    function angsuran() {
      if (saldoSisa() <= 0) return alert('Hutang sudah lunas ðŸŽ‰');
      const tgl = new Date();
      data.push({ tanggal: tgl.toISOString(), jumlah: angsuranHarian });
      localStorage.setItem('angsuran', JSON.stringify(data));
      sparkle();
      renderRiwayat();
      renderChart();
      updateInfo();
    }

    function renderRiwayat() {
      const ul = document.getElementById('riwayat');
      ul.innerHTML = '';
      data.forEach((d, i) => {
        const li = document.createElement('li');
        li.innerText = `${i+1}. ${new Date(d.tanggal).toLocaleDateString('id-ID')} - Rp25.000`;
        ul.appendChild(li);
      });
    }

    let chart;
    function renderChart() {
      const ctx = document.getElementById('chart');
      const labels = data.map((_, i) => i+1);
      const values = data.map((_, i) => hutangAwal - (i+1)*angsuranHarian);
      if (chart) chart.destroy();
      chart = new Chart(ctx, {
        type: 'line',
        data: { labels, datasets: [{ data: values, fill: false }] },
        options: { responsive: true }
      });
    }

    function sparkle() {
      for (let i = 0; i < 12; i++) {
        const s = document.createElement('div');
        s.className = 'sparkle';
        s.style.left = Math.random()*window.innerWidth + 'px';
        s.style.top = Math.random()*window.innerHeight + 'px';
        document.body.appendChild(s);
        setTimeout(() => s.remove(), 1000);
      }
    }

    function toggleDark() {
      document.body.classList.toggle('dark');
    }

    renderRiwayat();
    renderChart();
    updateInfo();
  </script>
</body>
</html>
